<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Form - Student Registration</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 8px; margin-bottom: 10px; }
        button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; }
        .debug { background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 4px; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Debug Student Registration Form</h1>
    
    <form id="debug-form">
        <div class="form-group">
            <label>First Name *</label>
            <input type="text" name="firstName" required>
        </div>
        
        <div class="form-group">
            <label>Last Name *</label>
            <input type="text" name="lastName" required>
        </div>
        
        <div class="form-group">
            <label>Class *</label>
            <input type="text" name="class" required>
        </div>
        
        <div class="form-group">
            <label>Division *</label>
            <input type="text" name="division" required>
        </div>
        
        <div class="form-group">
            <label>Parent Mobile *</label>
            <input type="tel" name="parent_mobile" required>
        </div>
        
        <div class="form-group">
            <label>Email</label>
            <input type="email" name="email">
        </div>
        
        <button type="submit">ğŸš€ Register Student</button>
    </form>
    
    <div id="debug-log" class="debug">
        <h3>ğŸ› Debug Log:</h3>
        <div id="log-content">Ready to test...</div>
    </div>
    
    <div id="result"></div>

    <script>
        const debugLog = document.getElementById('log-content');
        const result = document.getElementById('result');
        
        function log(message) {
            console.log(message);
            debugLog.innerHTML += '<br>' + new Date().toLocaleTimeString() + ': ' + message;
        }
        
        document.getElementById('debug-form').onsubmit = async function(e) {
            e.preventDefault();
            log('ğŸš€ Form submission started');
            
            const form = e.target;
            const data = {};
            
            // Collect form data
            for (let el of form.elements) {
                if (el.name && el.type !== 'submit') {
                    data[el.name] = el.value;
                    log(`ğŸ“ Field ${el.name}: "${el.value}"`);
                }
            }
            
            log('ğŸ“Š Form data collected: ' + JSON.stringify(data, null, 2));
            
            // Validation
            const required = ['firstName', 'lastName', 'class', 'division', 'parent_mobile'];
            const missing = required.filter(field => !data[field]);
            
            if (missing.length > 0) {
                log('âŒ Validation failed - missing: ' + missing.join(', '));
                result.innerHTML = '<div class="error">Missing required fields: ' + missing.join(', ') + '</div>';
                return;
            }
            
            log('âœ… Validation passed');
            
            try {
                log('ğŸŒ Sending POST request to /add-student');
                const response = await fetch('/add-student', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                log(`ğŸ“¨ Response status: ${response.status} ${response.statusText}`);
                
                if (response.ok) {
                    const responseText = await response.text();
                    log('âœ… Success response received');
                    result.innerHTML = '<div class="success">âœ… Student registered successfully!</div>';
                } else {
                    const errorText = await response.text();
                    log('âŒ Error response: ' + errorText.substring(0, 100));
                    result.innerHTML = '<div class="error">âŒ Registration failed</div>';
                }
            } catch (error) {
                log('ğŸ’¥ Network error: ' + error.message);
                result.innerHTML = '<div class="error">ğŸ’¥ Network error: ' + error.message + '</div>';
            }
        };
        
        log('ğŸ”§ Debug form initialized');
    </script>
</body>
</html>